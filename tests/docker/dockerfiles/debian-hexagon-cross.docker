FROM qemu/debian10

# What we need to build QEMU itself (as this is used in CI as well)
RUN apt update && \
    DEBIAN_FRONTEND=noninteractive eatmydata \
    apt build-dep -yy qemu

RUN DEBIAN_FRONTEND=noninteractive eatmydata \
    apt install -y --no-install-recommends \
        bison \
        cmake \
        flex \
        lld \
        rsync \
        wget

ENV TOOLCHAIN_INSTALL /usr
ENV ROOTFS /usr

ENV LLVM_URL https://github.com/llvm/llvm-project/archive/3d8149c2a1228609fd7d7c91a04681304a2f0ca9.tar.gz
ENV MUSL_URL https://github.com/quic/musl/archive/aff74b395fbf59cd7e93b3691905aa1af6c0778c.tar.gz
ENV LINUX_URL https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.6.18.tar.xz

ADD build-toolchain.sh /root/hexagon-toolchain/build-toolchain.sh

RUN ( cd /root/hexagon-toolchain && ./build-toolchain.sh ) && \
    rm -rf /root/hexagon-toolchain
